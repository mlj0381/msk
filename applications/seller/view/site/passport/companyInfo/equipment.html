<input type="hidden" name="equipment[content_id]" value="<{$extra.equipment.content_id}>" class="form-control">
<div id="equipment">
    <h4>检测设备</h4>
    <div class="creat-wrap" data-module="creater">
        <div id="items" data-items="itemList">
            <{*foreach from=$extra.equipment item=item*}>
                <div class="equipment-items team-item" data-item="creat-item">
                    <div class="form-group">
                        <label class="col-xs-2 control-label">
                            <span class="text-danger">*</span>主要设备：
                        </label>
                        <div class="col-xs-4">
                            <input type="hidden" name="equipment[content_id][]" value="<{$item.content_id}>" class="form-control">
                            <input type="text" value="<{$item.value.main_device}>" name="equipment[value][main_device][]" class="form-control" required="true">
                            <span class="msgTip" data-message="error"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-2 control-label">
                            <span class="text-danger">*</span>用途：
                        </label>
                        <div class="col-xs-4">
                            <input type="text" value="<{$item.value.use}>" name="equipment[value][use][]" class="form-control" required="true">
                            <span class="msgTip" data-message="error"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-2 control-label">
                            <span class="text-danger">*</span>上传设备照片：
                        </label>
                        <div class="col-xs-4">
                            <{input type="imageupload" tag="图片上传" name="equipment[attach][]" value=$item.attach required='true' accept="jpg|png|gif" }>
                            <span class="msgTip" data-message="error">不能为空</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-2 control-label">
                        </label>
                        <div class="col-xs-4">
                            <button class="del-team btn btn-danger delBtn" type="button">删除</button>
                        </div>
                    </div>
                    <hr>
                </div>
            <{*/foreach*}>    
        </div>
        <div class="form-group">
            <label class="col-xs-2 control-label">
            </label>
            <div class="col-xs-4">
                <button class="team btn btn-danger addBtn" type="button">
                    保存并继续添加设备
                </button>
            </div>
        </div> 
    </div>
</div>
<script type="text/javascript">

    $('div[data-module="creater"]').each(function(index, el) {
        var addBtn = $(this).find('.addBtn');
        var delBtn = $(this).find('delBtn');
        var items = $(this).find('div[data-items="itemList"]');
        var item = items.find('div[data-item="creat-item"]');
        var itemLen = item.size();
        //var html = item.prop('outerHTML');
        var html = items.clone(true).html();  
        //增加
        addBtn.bind('click',function(){
            $('div[data-module="creater"]').find('div[data-items="itemList"]').append(html);
            itemLen++;
            $.VMC.init();
        })
        //删除
        var _this = $('div[data-module="creater"]');
        if(itemLen <= 1){
           item.find($('.delBtn')).hide(); 
        }
        _this.on('click','.delBtn',function(){
            var parent = $(this).parents('div[data-item="creat-item"]');
            var content_id = parent.find('input[name="equipment[content_id][]"]').val();
            var url = '<{link app=seller ctl=site_passport act=del_extra}>';
            $.post(url, {content_id: content_id}, function (re) {
                if (re.success) {
                    parent.remove();
                } else {
                    alert('操作失败');
                }
            });

            $(this).parents('div[data-item="creat-item"]').remove();
            itemLen--;
        });    
    });
</script>

