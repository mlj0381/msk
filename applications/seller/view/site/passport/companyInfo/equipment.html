<input type="hidden" name="equipment[content_id]" value="<{$extra.equipment.content_id}>" class="form-control">
<div id="equipment">
    <h4>检测设备</h4>
    <div id="items" data-module="creater">
        <{*foreach from=$extra.equipment item=item*}>
            <div class="equipment-items team-item" data-item="creater-item">
                <div class="form-group">
                    <label class="col-xs-2 control-label">
                        <span class="text-danger">*</span>主要设备：
                    </label>
                    <div class="col-xs-4">
                        <input type="hidden" name="equipment[content_id][]" value="<{$item.content_id}>" class="form-control">
                        <input type="text" value="<{$item.value.main_device}>" name="equipment[value][main_device][]" class="form-control" required="true">
                        <span class="msgTip" data-message="error"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-2 control-label">
                        <span class="text-danger">*</span>用途：
                    </label>
                    <div class="col-xs-4">
                        <input type="text" value="<{$item.value.use}>" name="equipment[value][use][]" class="form-control" required="true">
                        <span class="msgTip" data-message="error"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-2 control-label">
                        <span class="text-danger">*</span>上传设备照片：
                    </label>
                    <div class="col-xs-4">
                        <{input type="imageupload" tag="图片上传" name="equipment[attach][]" value=$item.attach required='true' accept="jpg|png|gif" }>
                        <span class="msgTip" data-message="error">不能为空</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-2 control-label">
                    </label>
                    <div class="col-xs-4">
                        <button class="del-team btn btn-danger delBtn" type="button">删除</button>
                    </div>
                </div>
                <hr>
            </div>
        <{*/foreach*}>
        <div class="form-group">
            <label class="col-xs-2 control-label">
            </label>
            <div class="col-xs-4">
                <button class="team btn btn-danger addBtn" type="button">
                    保存并继续添加设备
                </button>
            </div>
        </div>     
    </div>
</div>
<script type="text/javascript">
$(".test").click(function(){alert('')})
    $('div[data-module="creater"]').each(function(index, el) {
        var addBtn = $(this).find('.addBtn');
        var delBtn = $(this).find('delBtn');
        var item = $(this).find('div[data-item="creater-item"]');
        var itemLen = item.size();
        var html = item.prop('outerHTML'); 
        //增加
        addBtn.bind('click',function(){
            $('div[data-module="creater"]').children('div[data-item="creater-item"]:last').after(html);
            itemLen++;
        })
        //删除
        var _this = $('div[data-module="creater"]');
        if(itemLen <= 1){
           item.find($('.delBtn')).hide(); 
        }
        _this.on('click','.delBtn',function(){
            $(this).parents('div[data-item="creater-item"]').remove();
            itemLen--;
        })        
    });
</script>
<!-- <textarea class="ex-group hide">
    <div class="equipment-items">
        <div class="form-group">
            <label class="col-xs-2 control-label">
                <span class="text-danger">*</span>主要设备：
            </label>

            <div class="col-xs-4">
                <input type="hidden"
                       name="equipment[content_id][]"
                       value="<{$extra.content_id}>"
                       class="form-control">
                <input type="text"
                       value="<{$extra.equipment.value.main_device}>"
                       name="equipment[value][main_device][]"
                       class="form-control" required="true">
                        <span class="msgTip" data-message="error"></span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-xs-2 control-label">
                <span class="text-danger">*</span>用途：
            </label>

            <div class="col-xs-4">
                <input type="text"
                       value="<{$extra.equipment.value.use}>"
                       name="equipment[value][use][]"
                       class="form-control" required="true">
                       <span class="msgTip" data-message="error"></span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-xs-2 control-label">
                <span class="text-danger">*</span>上传设备照片：
            </label>

            <div class="col-xs-4">
                <div class="filebox">
                    <input type="hidden"
                           value="<{$extra.equipment.attach}>"
                           name="equipment[attach][]"/>
                    <input type="file"
                           data-url="<{link app=image ctl=site_upload act=index}>"
                           accept="image/*"
                           class="file_input"/>

                    <div class="showImg">
                        <img src="<{if $extra.equipment.value.attach eq ''}><{$base_url}>/themes/pc/default/statics/images/file_add.jpg<{else}><{$extra.equipment.value.attach|storager:'xs'}><{/if}>">
                    </div>
                </div>
            </div>
        </div>
         <div class="form-group">
            <label class="col-xs-2 control-label">
            </label>
        
            <div class="col-xs-4">
                <button class="del-team"
                        type="button">
                    删除
                </button>
            </div>
        </div>
        <hr>
    </div>
</textarea> -->
<script>
/*void function (ec_group) {
        var fileObj = {
            add: function (e, data) {
                if (!data.files[0]['type'].match(/^image/)) {
                    alert('非法上传，不是图片类型');
                }
                data.submit();
            },
            done: function (e, data) {
                var re = $.parseJSON(data.result);
                var input = e.target || e.srcElement;
                var parent = $(input).closest('div');
                $(parent).find('input[type="hidden"]').attr('value', re.image_id);
                $(parent).find('img').attr('src', re.url);

            }
        };

        ec_group.find('.team').click(function (e) {
            e.stopPropagation();
            var data = ec_group.find('.equipment-items:last').find('*').serializeArray();
            console.table(data);
            var url = '<{link app=seller ctl=site_passport act=save_ecgroup}>';
            $.post(url, data, function (re) {
                if (re.success) {
                    $('.equipment-items:last').find('input[name="equipment[content_id][]"]').val(re.data.content_id);
                    var item = $('.ex-group').val();
                    $(item).insertAfter($('#items .equipment-items:last'));
                    //$('.team-item:last').find('input [type="text"]').val('');
                    $('.equipment-items:last').find('.file_input').fileupload(fileObj);
                    $('.equipment-items:last').find('.del-team').click(function () {
                        del($(this))
                    });
                }
            });
        });

        var init = function () {
            var item = $('.ex-group').val();
            if (!$('#items').find('.equipment-items').size()) {
                $(item).find('.del-team').remove();
                $(item).appendTo($('#items'));
            }
//            else {
//                $(item).insertAfter($('#items .equipment-items:last'));
//                $(item).click(function () {
//                    del($(item));
//                });
//                //$('.team-item:last').find('input [type="text"]').val('');
//            }
            $('.equipment-items:last').find('.file_input').fileupload(fileObj);
        };
        (function () {
            if (!$('#items').find('.equipment-items').size()) {
                init();
            }
        })();

        ec_group.find('.del-team').click(function () {
            if(!confirm('确定删除？')) return false;
            del($(this));
        });

        var del = function (obj) {
            var parent = $(obj).closest('div.equipment-items');
            var content_id = parent.find('input[name="equipment[content_id][]"]').val();
            var url = '<{link app=seller ctl=site_passport act=del_extra}>';
            $.post(url, {content_id: content_id}, function (re) {
                if (re.success) {
                    parent.remove();
                } else {
                    alert('操作失败');
                }
            });
        };
    }($('#companyInfo_form'));*/
</script>
