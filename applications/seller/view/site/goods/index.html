
<h3 class="page-title"><{if $type eq 'storage'}>仓库<{else}>在售<{/if}>商品</h3>

<!-- <div class="table-toolbar">
    <div class="btn-group">
        <a class="btn green"  label="添加商品" icon="fa-plus" href="<{link app=seller ctl=site_goods act=add}>">
                添加商品&nbsp;<i class="fa fa-plus"></i>
        </a>
    </div>
</div> -->
<form  action="<{link app=seller ctl=site_classify act=update}>" method="post">


<div class="table-scrollable">
    <table class="table  table-striped table-hover">
        <thead>
            <tr>
                <th>商品编号</th>
                <th>所属品牌</th>
                <th>商品名称</th>
                <th>所属分类</th>
                <th>销售类型</th>
                <{if $type neq 'storage'}><th>推荐</th><{/if}>
                <th>操作</th>

            </tr>
        </thead>
    <tbody id="cat_list">
        <{foreach from=$goodList item=item name="item"}>
            <tr>
                <td><{$item.gid}></td>
                <td><{$item.brand_id}></td>
                <!-- <td class="tdObj" data-id="<{$item.goods_id}>"><{$item.name|cut:50:'...'}></td> -->
                <td><input class='form-control edit-col input-sm' name="goods_name" type='text' data-pkey='<{$item.goods_id}>' value='<{$item.name|cut:50:'...'}>'></td>
                <td><{$item.cat_id}></td>

                <td><{$item.goods_type}></td>

               <{if $type neq 'storage'}>
                   <td>
                       <{input class="form-control" type="select" data-pkey=$item.goods_id  name="choose" style="font-size:12px;width:100px;height:30px;" value=$item.choose  rows=$choose valueColumn="ch_id" labelColumn="ch_name"}>
                   </td>
               <{/if}>

                    <td>
                         <{if $type eq 'storage'}>
                            <!-- <if $item.checkin eq '0'>
                                <a class="btn btn-xs btn-default">审核中</a>
                            <elseif $item.checkin eq '-1'>
                                <a class="btn btn-xs btn-default">未通过</a>
                            <elseif $item.marketable eq 'false'> -->
                                <a href="<{link app=seller ctl=site_goods act=marketable args0=$item.goods_id args1=up}>" class="btn btn-xs btn-default">上架</a>
                            <!-- </if> -->
                        <{else}>
                            <a href="<{link app=seller ctl=site_goods act=marketable args0=$item.goods_id args1=dn}>" class="btn btn-xs btn-default">下架</a>
                        <{/if}>

                    <a href="<{link app=seller ctl=site_goods act=add args0=$item.goods_id}>" class="btn btn-xs btn-default"><i class="fa fa-edit"></i>编辑</a>
                </td>
                <td>
            </tr>
        <{/foreach}>
    </tbody>
    </table>
</div>
</form>
<script type="text/javascript">
$(function(){
    $('#cat_list').on('focus', 'input.edit-col', function(){
        $(this).data('v', $(this).val());
    });
    $('#cat_list').on('blur', 'input.edit-col', function(){
        var edit_input = $(this);
        if(edit_input.val() == edit_input.data('v')) return;
        var updateValue = {
            'goods_id' : edit_input.attr('data-pkey'),
        };
        updateValue['name'] = edit_input.val();
        $.post('<{link app=seller ctl=site_goods act=edit}>', updateValue, function(re){
            if(re && ('success' in re)) {
                edit_input.data('v', edit_input.val());
                edit_input.val('已修改').fadeOut(function(){
                    edit_input.val(edit_input.data('v'));
                }).fadeIn();
            }
        },'json');
    });
    $("[type=select]").change(function(){
        var edit_input = $(this);
        var updateValue = {
            'goods_id' : edit_input.attr('data-pkey'),
            'choose' : edit_input.val(),
        }
        $.post('<{link app=seller ctl=site_goods act=edit}>', updateValue, function(re){
            if(re && ('success' in re)){
                //修改成功
            }
        }, 'json');
    });
});
</script>

<div class="modal fade" id="cat_edit" role="basic" aria-hidden="true">
              <div class="modal-dialog">
                      <div class="modal-content">

                      </div>
              </div>
</div>
