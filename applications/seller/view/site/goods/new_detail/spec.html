<div id="sepcInfo" >
    <h4><span class="text-danger">*</span>商品规格</h4>
    <!-- spec -->
    <table class="table spec_table">
        <thead>
        <tr>
            <td>规格名称</td>
            <td>商品货号</td>
            <td>价盘设置</td>
            <!--<td>商品库存</td>-->
            <td>是否分销</td>
            <td>是否上架</td>
        </tr>
        </thead>
        <tbody>
            <{foreach from=$goods.product key=key item=item}>
            <tr>
                <td>
                    <input type="hidden" name="goods[product][new_<{$key}>][product_id]" value="<{$item.product_id}>">
                    <input type="text" name="goods[product][new_<{$key}>][spec_info]" class="form-control input-sm spec-info"
                           value="<{$item.spec_info}>">
                    <input type="hidden" name="goods[product][new_<{$key}>][spec_desc]" class="spec-desc" value="<{$item.spec_desc}>">
                </td>
                <td>
                    <input type="text" required="true" data-map="bn" class="form-control input-sm"
                           name="goods[product][new_<{$key}>][bn]" value="<{$item.bn}>">
                </td>
                <td class="price_set">
                    <div class="set_panel">
                        <div class="panel_title">
                            <span class="set_trigger"><i class="icon-cogs"></i> 设置价盘</span>
                            <span class="text-danger"><i class="icon-info-sign"></i>（价盘直接影响价格，请认真填写）</span>
                        </div>
                        <div class="table_wrap">
                            <table>
                                <thead>
                                <tr>
                                    <th>数量下限</th>
                                    <th>数量上限</th>
                                    <th>商品价格</th>
                                    <th>折扣率</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        <input type="text" name="goods[product][new_<{$key}>][interval_info][num_dn][]" value="1"
                                               class="form-control">
                                    </td>
                                    <td>
                                        <input type="text" name="goods[product][new_<{$key}>][interval_info][num_up][]" value="50"
                                               class="form-control">
                                    </td>
                                    <td>
                                        <input type="text" name="goods[product][new_<{$key}>][interval_info][price][]" value="100"
                                               class="form-control">
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <input type="text" name="goods[product][new_<{$key}>][interval_info][discount][]" value="90"
                                                   class="form-control">
                                            <span class="input-group-addon">%</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="icon-trash delbtn"></span>
                                        <span class="icon-plus addbtn"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </td>
                <!--<td>-->
                    <!--<input type="text" data-map="storage" class="form-control input-sm"-->
                           <!--name="goods[product][new_<{$key}>][quantity]" value="<{$item.stock.quantity}>">-->
                    <!--<input type="hidden" name="goods[product][new_<{$key}>][stock_id]" value="<{$item.stock.quantity}>">-->
                <!--</td>-->
                <td align="center">
                    <input type="checkbox" name="goods[agent]" value="true" checked>
                </td>
                <td align="center">
                    <input type="checkbox" name="goods[product][new_<{$key}>][marketable]" value="true" checked>
                </td>
            </tr>
            <{/foreach}>
        </tbody>
    </table>
    <!-- sepc end -->

    <textarea class="product-item-tpl hide">
        <tr>
            <td>
                <input type="text" name="goods[product][new_{2}][spec_info]" class="form-control input-sm spec-info"
                       value="{0}" readonly=true>
                <input type="hidden" name="goods[product][new_{2}][spec_desc]" class="spec-desc" value="{3}:::{4}">
            </td>
            <td>
                <input type="text" required="true" data-map="bn" class="form-control input-sm"
                       name="goods[product][new_{2}][bn]" value="{1}">
            </td>
            <td class="price_set">
                <div class="set_panel">
                    <div class="panel_title">
                        <span class="set_trigger"><i class="icon-cogs"></i> 设置价盘</span>
                        <span class="text-danger"><i class="icon-info-sign"></i>（价盘直接影响价格，请认真填写）</span>
                    </div>
                    <div class="table_wrap">
                        <table>
                            <thead>
                            <tr>
                                <th>数量下限</th>
                                <th>数量上限</th>
                                <th>商品价格</th>
                                <th>折扣率</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <input type="text" name="goods[product][new_{2}][interval_info][num_dn][]" value="1"
                                           class="form-control">
                                </td>
                                <td>
                                    <input type="text" name="goods[product][new_{2}][interval_info][num_up][]" value="50"
                                           class="form-control">
                                </td>
                                <td>
                                    <input type="text" name="goods[product][new_{2}][interval_info][price][]" value="100"
                                           class="form-control">
                                </td>
                                <td class="hide">
                                    <div class="input-group">
                                        <input type="text" name="goods[product][new_{2}][interval_info][discount][]" value="100"
                                               class="form-control">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </td>
                                <td>
                                    <span class="icon-trash delbtn"></span>
                                    <span class="icon-plus addbtn"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </td>
            <!-- <td>
                <input type="text" data-map="storage" class="form-control input-sm"
                       name="goods[product][new_{2}][stock]" value="100">
            </td> -->
            <td align="center">
                <input type="checkbox" name="goods[agent]" value="true" checked>
            </td>
            <td align="center">
                <input type="checkbox" name="goods[product][new_{2}][marketable]" value="true" checked>
            </td>
        </tr>
    </textarea>
</div>
<script type="text/javascript">

    $(function () {
//        !(function load_spec() {
//            var $html = $('.product-item-tpl').val();
//            var $spec_row = $('.spec_table tbody');
//            $spec_row.append($html);
//        })();
        //load_spec();

        //价盘panel 显隐
        $('.spec_table').on('mouseenter mouseleave', '.set_trigger', function (e) {
            var e = e || window.event;
            if (e.type == 'mouseenter') $(this).parents('.set_panel').find('.table_wrap').show();
            else $(this).parents('.set_panel').find('.table_wrap').hide();
        });
        $('.spec_table').on('mouseenter mouseleave', '.table_wrap', function (e) {
            var e = e || window.event;
            if (e.type == 'mouseenter') $(this).show();
            else $(this).hide();
        });
        //价盘添加删除
        var $price_row = $('.spec_table .table_wrap tbody tr').prop("outerHTML");
        $('.spec_table').on('click', '.addbtn', function () {
            var $rowLen = $('.spec_table .table_wrap tbody tr').size();
            if ($rowLen >= 9) return;
            $(this).parent().parent().after($price_row);
        });

        $('.spec_table').on('click', '.delbtn', function () {
            var $rowLen = $('.spec_table .table_wrap tbody tr').size();
            if ($rowLen <= 1) return;
            $(this).parent().parent().remove();
        });
    })
</script>
