<div class="fileinput fileinput-new" data-provides="fileinput" id="image_upload_box_<{$id}>">    
    <div class="filebox fileinput-new thumbnail" style="border:0px;padding:0px;margin-bottom:0px">
        <input type="hidden" value="<{$image_id}>" name="<{$name}>"/>
        <input type="file" data-url="<{link app=image ctl=site_upload act=index}>" accept="image/*" class="file_input" />
        <div class="showImg">
            <{if $image_id && $url}>
            <img src="<{$content.image|storager:'xs'}>" />
            <{else}>               
            <img src="<{$base_url}>/themes/pc/default/statics/images/file_add.jpg">
            <{/if}>
        </div>
    </div>
</div>
<script charset="utf-8">
$('#image_upload_box_<{$id}> input[type=file]').fileupload({
    <{if $tag}>
    formData:{tag:'<{$tag}>'},
    <{/if}>
    add:function(e,data){
        if(!data.files[0]['type'].match(/^image/)){
            return toastr.warning(data.files[0]['name']+'不是允许的图片类型','类型错误');
        }
        //$('#image_upload_box_<{$id}> .fileinput-btn-text').text('正在上传...');
        data.submit();
    },
    done:function(e,data){
        var re = $.parseJSON(data.result);
        if(!$('#image_upload_box_<{$id}> .thumbnail img').length){
            $('#image_upload_box_<{$id}> .thumbnail .showImg').empty().append('<img src="'+re.url+'"  /><input type="hidden" name="<{$name}>" value="'+re.image_id+'">');
        }else{
            $('#image_upload_box_<{$id}> .thumbnail .showImg img').attr('src',re.url);
            $('#image_upload_box_<{$id}> .thumbnail input[type="hidden"]').val(re.image_id);
        }
        //$('#image_upload_box_<{$id}> .fileinput-btn-text').text('从本地选择图片');
    }
});
</script>