<style>
#companyInfo_form .uploader {
    overflow: hidden;
    position: relative;
    background: none;
    height:auto;
}

#companyInfo_form .uploader .handle,
#companyInfo_form .uploader .thumb {
    cursor: pointer;
}

#companyInfo_form .uploader .thumb {
    height: 120px;
    width: 120px;
    border: 1px solid #CCC;
    overflow: hidden;
    display: table-cell;
    text-align: center;
    vertical-align: middle;
}

#companyInfo_form .uploader .thumb span.loading {
    font-size: 30px;
}

#companyInfo_form .uploader .thumb img {
    display: block;
    margin: auto;
    max-height: 118px;
    max-width: 118px;
}

#companyInfo_form .uploader .handle {
    position: absolute;
    top: 0;
    left: 0;
    margin: 0;
    opacity: 0;
    -ms-filter: 'alpha(opacity=0)';
    width: 120px;
    height: 120px;
}

#companyInfo_form .uploader label.right {
    display: inline-block;
    position: absolute;
    left: 130px;
    min-height: 16px;
    top: 45px;
}
span.msgTip{
    display: none;
}
</style>
<div class="passport-signup-container seller_regbox">
    <div class="panel panel-default signup-panel clearfix">
        <div class="panel-body">
            <form id="companyInfo_form" action="<{link app=seller ctl=site_passport act=entry}>" class="form-horizontal companyInfo_form" method="post" data-module="validator">
                <h3><{$pageSet.companyType}>  <small> <{$pageSet.label}></small></h3>
                <input type="hidden" name="typeId" value="<{$pageSet.typeId}>" />
                <input type='hidden' name='pageIndex' value='<{$pageIndex}>' />
                <!-- 三证合一 -->
                <{foreach from=$pageSet.page key=key item=item}>
                <{include file="site/passport/companyInfo/{$item}.html" extra=$info.company_extra}>
                <{/foreach}>
                <hr>
                <div class="form-group">
                    <label class="col-xs-2"></label>
                    <div class="col-xs-4">
                        <a href="<{link app=seller ctl=site_passport act=entry args0=$pageIndex args1=up}>" <{if $pageIndex neq '1'}> disabled <{/if}>  class="btn btn-default">上一页</a>
                        <a class="btn btn-danger" style="margin-left: 20px;">下一页</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
/**
 *动态添加多项,例如：检测设备，电商团队成员，企业荣誉，车间概况
 */
var itemLength = function(obj) {
    var items = obj.find('div[data-items="itemList"]');
    var item = items.find('div[data-item="creat-item"]:first');
    item.find($('.delBtn')).hide();
}
$('div[data-module="creater"]').each(function(index, el) {

    var addBtn = $(this).find('.addBtn');
    var delBtn = $(this).find('delBtn');
    var items = $(this).find('div[data-items="itemList"]');
    var item = items.find('div[data-item="creat-item"]');
    var itemLen = item.size();
    var html = items.find('div[data-item="creat-item"]:first').prop("outerHTML");
    var _this = $(this);
    var imgUrl = '<{$base_url}>/public/javascripts/images/add.jpg';

    //增加
    addBtn.bind('click', function() {
        _this.find('div[data-items="itemList"]').append(html);
        _this.find('div[data-item="creat-item"]:last').find('input').val('');
        _this.find('div[data-item="creat-item"]:last').find('img').attr('src', imgUrl);
        itemLen++;
        $.VMC.init();
    })

    //删除

    if (itemLen <= 1) {
        item.find($('.delBtn')).hide();
    }
    itemLength(_this);
    _this.on('click', '.delBtn', function() {
        if (!confirm('确定删除')) return false;
        var parent = $(this).parents('div[data-item="creat-item"]');
        var content_id = parent.find('.content_id').val();
        if (!content_id) {
            parent.remove();
            return false;
        }
        var url = '<{link app=seller ctl=site_passport act=del_extra}>';
        $.post(url, {
            content_id: content_id
        }, function(re) {
            if (re.success) {
                parent.remove();
                itemLen--;
                itemLength(_this);
            } else {
                alert('操作失败');
            }
        });
    });
});



/**
 * 表单验证
 */

void
function(signup_form) {
    var _alert_error = function(msg) {
        signup_form.find('.alert-error').remove();
        signup_form.append($('<div class="alert alert-danger">' + msg + '</div>'));
        alert_timer = setTimeout(function() {
            clearTimeout(alert_timer);
            signup_form.find('.alert-danger').fadeOut('fast', function() {
                $(this).remove();
            });
        }, 3000);
    }
    signup_form.on('submit', function(e) {
        e.stopPropagation();
        $.post(signup_form.attr('action'), signup_form.serialize(), function(re) {
            if (re.error) {
                _alert_error(re.error);
            } else if (re.success) {
                location = re.redirect;
            }
        }, 'json');
        return false;
    });
}($('#seller_signup_form'));



$('#companyInfo_form .business').change(function() {
    var typeId = $('#companyInfo_form input[name="typeId"]').val().trim();
    var url = '<{link app=seller ctl=site_passport act=check_company}>';
    $.post(url, {
        business: $(this).val().trim(),
        business_type: 0,
        type_id: typeId
    }, function(re) {
        console.log(re);
    })
});
</script>
